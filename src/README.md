# riscv

## vm

```
$ make vm
gcc elf/elf.c riscv/riscv.c riscv/cpu.c riscv/memory.c vm.c -o vm
$ make vrun
vm ../data/oshello.elf
.text: body=0000000000631080 offset=0x80000000 size=32996
rv_init()...
mem_load_elf()...
mem_io_init() begin
rv_run()...
Hello OS!
mem_free()...
```

## dasm

```
$ make run
gcc ../elf/elf.c riscv.c dasm.c -o dasm
./dasm ../obj/oshello.elf
s.body=0000000000412988 offset=0x80000000 size=32996
080000000: f14022f3 csrrs t0,x0,mhartid
080000004: 00a29293 slli t0,t0,10
080000008: 00002117 auipc sp,0x2
08000000c: 02010113 addi sp,sp,32
080000010: 00510133 add sp,sp,t0
080000014: f1402573 csrrs a0,x0,mhartid
080000018: 00051463 bne x0,a0,0x80000020
08000001c: 0a80806f jal x0,0x800080c4
080000020: 10500073 wfi
080000024: ffdff06f jal x0,0x80000020
080008028: fe010113 addi sp,sp,-32
08000802c: 00812e23 sw s0,28(sp)
080008030: 02010413 addi s0,sp,32
080008034: 00050793 addi a5,a0,0
080008038: fef407a3 sb a5,-17(s0)
08000803c: 00000013 addi x0,x0,0
080008040: 100007b7 lui a5,0x10000
080008044: 00578793 addi a5,a5,5
080008048: 0007c783 lbu a5,0(a5)
08000804c: 0407f793 andi a5,a5,64
080008050: fe0788e3 beq x0,a5,0x80008040
080008054: 100007b7 lui a5,0x10000
080008058: fef44703 lbu a4,-17(s0)
08000805c: 00e78023 sb a4,0(a5)
080008060: 0007c783 lbu a5,0(a5)
080008064: 00078513 addi a0,a5,0
080008068: 01c12403 lw s0,28(sp)
08000806c: 02010113 addi sp,sp,32
080008070: 00008067 jalr x0,0x8
080008074: fe010113 addi sp,sp,-32
080008078: 00112e23 sw ra,28(sp)
08000807c: 00812c23 sw s0,24(sp)
080008080: 02010413 addi s0,sp,32
080008084: fea42623 sw a0,-20(s0)
080008088: 01c0006f jal x0,0x800080a4
08000808c: fec42783 lw a5,-20(s0)
080008090: 00178713 addi a4,a5,1
080008094: fee42623 sw a4,-20(s0)
080008098: 0007c783 lbu a5,0(a5)
08000809c: 00078513 addi a0,a5,0
0800080a0: f89ff0ef jal ra,0x80008028
0800080a4: fec42783 lw a5,-20(s0)
0800080a8: 0007c783 lbu a5,0(a5)
0800080ac: fe0790e3 bne x0,a5,0x8000808c
0800080b0: 00000013 addi x0,x0,0
0800080b4: 01c12083 lw ra,28(sp)
0800080b8: 01812403 lw s0,24(sp)
0800080bc: 02010113 addi sp,sp,32
0800080c0: 00008067 jalr x0,0x8
0800080c4: ff010113 addi sp,sp,-16
0800080c8: 00112623 sw ra,12(sp)
0800080cc: 00812423 sw s0,8(sp)
0800080d0: 01010413 addi s0,sp,16
0800080d4: 00000517 auipc a0,0x0
0800080d8: 01050513 addi a0,a0,16
0800080dc: f99ff0ef jal ra,0x80008074
0800080e0: 0000006f jal x0,0x800080e0
```
